{
  "openapi": "3.0.1",
  "info": {
    "title": "API de gestion des contrats HTP",
    "version": "1.0.0",
    "description": "API de gestion des contrats HTP"
  },
  "servers": [
    {
      "url": "/beyond/api/contractevents/"
    }
  ],
  "security": [
    {
      "bearer": [
        "read",
        "write"
      ]
    }
  ],
  "paths": {
    "/v5/declarants/{idDeclarant}/contracts/{numeroContrat}/insureds/{numeroPersonne}/data": {
      "put": {
        "description": "Mise à jour des données d'un assuré identifié par son numéro de personne sur le contrat",
        "tags": [
          "Mise à jour d'un assuré sur un contrat"
        ],
        "operationId": "updateDataInsured",
        "parameters": [
          {
            "name": "idDeclarant",
            "in": "path",
            "required": true,
            "description": "Organisation principale",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "numeroContrat",
            "description": "Identifiant contrat dans le backoffice contrat",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "numeroPersonne",
            "description": "Identifiant unique de l'assuré dans le backoffice Contrat",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/DataAssure"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Reponse"
                }
              }
            }
          },
          "404": {
            "description": "Erreur. Assuré non trouvé",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Reponse"
                },
                "example": {
                  "traceid": "6427273c4a592414c6b1d81b",
                  "status": "InsuredNotFound",
                  "errorMessages": [
                    "Le contrat TEST01 de l'AMC xxxxxxxxxx possédant le bénéficiaire ayant pour numéro de personne TEST123 n'a pas été trouvé"
                  ],
                  "provider": "BDDS"
                }
              }
            }
          },
          "400 - Erreur validations des données": {
            "description": "Erreur de validation des données en entrée",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Reponse"
                },
                "example": {
                  "traceid": "642727c24a592414c6b1d81d",
                  "status": "ValidationFailed",
                  "errorMessages": [
                    "L'information dateNaissance(200805179) n'est pas une date au format yyyyMMdd"
                  ],
                  "provider": "BDDS"
                }
              }
            }
          },
          "400 - Compte invalide": {
            "description": "Identifiant du compte utilisé par le backoffice invalide",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Reponse"
                },
                "example": {
                  "traceid": "642727e94a592414c6b1d81e",
                  "status": "IdClientBOInvalid",
                  "errorMessages": [
                    "L'identifiant Back Office service-account-test ne permet pas d'accéder aux données du déclarant xxxxxxxxxx"
                  ],
                  "provider": "BDDS"
                }
              }
            }
          }
        }
      }
    },
    "/v5/declarants/{idDeclarant}/contracts": {
      "post": {
        "description": "Création/mise à jour d'un contrat HTP",
        "tags": [
          "Création/mise à jour d'un contrat HTP"
        ],
        "operationId": "createContract",
        "parameters": [
          {
            "name": "idDeclarant",
            "description": "Organisation principale",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/Contrat"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Reponse"
                }
              }
            }
          },
          "400 - Erreur validation contrat": {
            "description": "Erreur de validation du contrat",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Reponse"
                },
                "example": {
                  "traceid": "642725e74a592414c6b1d814",
                  "status": "ValidationFailed",
                  "errorMessages": [
                    "L'information numero est obligatoire",
                    "L'information periodesContratResponsableOuvert.periode.debut(2018-01-019) n'est pas une date au format yyyy-MM-dd"
                  ],
                  "provider": "BDDS"
                }
              }
            }
          },
          "400 - incohérence dans l'organisation principale": {
            "description": "Incohérence entre les numéros identifiants les organisations principales",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Reponse"
                },
                "example": {
                  "traceid": "6427260e4a592414c6b1d815",
                  "status": "IdClientBOInvalid",
                  "errorMessages": [
                    "Incohérence entre les déclarants (Contrat/URL)"
                  ],
                  "provider": "BDDS"
                }
              }
            }
          },
          "400 - compte invalide": {
            "description": "Identifiant du compte utilisé par le backoffice invalide",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Reponse"
                },
                "example": {
                  "traceid": "642726894a592414c6b1d81a",
                  "status": "IdClientBOInvalid",
                  "errorMessages": [
                    "L'identifiant Back Office service-account-test ne permet pas d'accéder aux données du déclarant xxxxxxxxxx"
                  ],
                  "provider": "BDDS"
                }
              }
            }
          }
        }
      }
    },
    "/v6/declarants/{idDeclarant}/contracts": {
      "post": {
        "description": "Création/mise à jour d'un contrat HTP",
        "tags": [
          "Création/mise à jour d'un contrat HTP"
        ],
        "operationId": "createContract",
        "parameters": [
          {
            "name": "idDeclarant",
            "description": "Correspond à une AMC définie dans la Gestion des AMCs de la BDDS. Cette AMC doit obligatoirement être liée à une Organisation Principale ou une Organisation secondaire",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/Contrat"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Reponse"
                }
              }
            }
          },
          "400": {
            "description": "Erreur de validation du contrat ou identifiant du compte utilisé par le backoffice invalide",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Reponse"
                },
                "example": {
                  "traceid": "642725e74a592414c6b1d814",
                  "status": "ValidationFailed",
                  "errorMessages": [
                    "L'information numero est obligatoire",
                    "L'information periodesContratResponsableOuvert.periode.debut(2018-01-019) n'est pas une date au format yyyy-MM-dd"
                  ],
                  "provider": "BDDS"
                }
              }
            }
          }
        }
      }
    },
    "/v4/declarants/{idDeclarant}/contracts/{numeroContrat}/subscriberId/{numeroAdherent}": {
      "delete": {
        "description": "Sans effet d'un contrat HTP",
        "tags": [
          "Sans effet d'un contrat HTP"
        ],
        "operationId": "deleteContract",
        "parameters": [
          {
            "name": "idDeclarant",
            "description": "Organisation principale",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "numeroContrat",
            "description": "Identifiant contrat dans le backoffice contrat",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "numeroAdherent",
            "description": "Numéro d'adhérent dans le backoffice contrat",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK"
          },
          "404": {
            "description": "Erreur. Contrat inconnu",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Reponse"
                },
                "example": {
                  "traceid": "6426d7ee2107c30eaba96778",
                  "status": "ContractNotFound",
                  "errorMessages": [
                    "Aucun contrat n'existe avec les informations fournies"
                  ],
                  "provider": "BDDS"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "Adresse": {
        "type": "object",
        "properties": {
          "ligne1": {
            "type": "string",
            "description": "Identité du destinataire"
          },
          "ligne2": {
            "type": "string",
            "description": "Identification du point de remise (numéro appartement, numéro boite aux lettres, étage, ..."
          },
          "ligne3": {
            "type": "string",
            "description": "Complément de localisation (entrée, bâtiment, ...)"
          },
          "ligne4": {
            "type": "string",
            "description": "Numéro et libellé de la voie"
          },
          "ligne5": {
            "type": "string",
            "description": "Service de distribution - complément de localisation de la voie (poste restante, boite postale, ...)"
          },
          "ligne6": {
            "type": "string",
            "description": "Code postal et localité"
          },
          "ligne7": {
            "type": "string",
            "description": "Pays (pour l'international)"
          },
          "codePostal": {
            "type": "string",
            "description": "Code postal"
          },
          "pays": {
            "type": "string",
            "description": "Pays"
          },
          "telephone": {
            "type": "string",
            "description": "Numéro de téléphone"
          },
          "email": {
            "type": "string",
            "description": "Email"
          }
        }
      },
      "AdresseAssure": {
        "type": "object",
        "properties": {
          "ligne1": {
            "type": "string",
            "description": "Identité de l'assuré"
          },
          "ligne2": {
            "type": "string",
            "description": "Identification du point de remise (numéro appartement, numéro boite aux lettres, étage, ..."
          },
          "ligne3": {
            "type": "string",
            "description": "Complément de localisation (entrée, bâtiment, ...)"
          },
          "ligne4": {
            "type": "string",
            "description": "Numéro et libellé de la voie"
          },
          "ligne5": {
            "type": "string",
            "description": "Service de distribution - complément de localisation de la voie (poste restante, boite postale, ...)"
          },
          "ligne6": {
            "type": "string",
            "description": "Code postal et localité"
          },
          "ligne7": {
            "type": "string",
            "description": "Pays (pour l'international)"
          },
          "codePostal": {
            "type": "string",
            "description": "Code postal"
          }
        }
      },
      "Contact": {
        "type": "object",
        "properties": {
          "fixe": {
            "type": "string",
            "description": "Numéro de téléphone fixe"
          },
          "mobile": {
            "type": "string",
            "description": "Numéro de téléphone mobile"
          },
          "email": {
            "type": "string",
            "format": "email",
            "description": "Email"
          }
        }
      },
      "DataAssure": {
        "type": "object",
        "properties": {
          "dateNaissance": {
            "type": "string",
            "description": "Date de naissance de l'assuré"
          },
          "rangNaissance": {
            "type": "string",
            "description": "Rang de naissance de l'assuré"
          },
          "nir": {
            "$ref": "#/components/schemas/Nir"
          },
          "affiliationsRO": {
            "type": "array",
            "description": "Liste des affiliations RO de l'assuré",
            "items": {
              "$ref": "#/components/schemas/AffiliationsRO"
            }
          },
          "nom": {
            "$ref": "#/components/schemas/NomAssure",
            "description": "Nom de l'assuré"
          },
          "adresse": {
            "$ref": "#/components/schemas/AdresseAssure",
            "description": "Adresse de l'assuré"
          },
          "contact": {
            "$ref": "#/components/schemas/Contact",
            "description": "Données de contact de l'assuré"
          },
          "DestinatairePaiements": {
            "type": "array",
            "description": "Destinataires de paiement de l'assuré",
            "items": {
              "$ref": "#/components/schemas/DestinatairePaiements"
            }
          },
          "destinatairesRelevePrestations": {
            "type": "array",
            "description": "Destinataires de relevé de prestation de l'assuré",
            "items": {
              "$ref": "#/components/schemas/DestinataireRelevesPrestations"
            }
          }
        },
        "required": [
          "nom",
          "adresse"
        ]
      },
      "Nir": {
        "required": [
          "cle",
          "code"
        ],
        "type": "object",
        "description": "NIR",
        "properties": {
          "code": {
            "type": "string",
            "description": "Code du NIR"
          },
          "cle": {
            "type": "string",
            "description": "Clé du NIR"
          }
        }
      },
      "AffiliationsRO": {
        "required": [
          "nir",
          "periode"
        ],
        "type": "object",
        "properties": {
          "nir": {
            "$ref": "#/components/schemas/Nir"
          },
          "rattachementRO": {
            "$ref": "#/components/schemas/RattachementRO"
          },
          "periode": {
            "$ref": "#/components/schemas/Periode"
          }
        }
      },
      "RattachementRO": {
        "type": "object",
        "description": "Rattachement ",
        "properties": {
          "CodeRegime": {
            "type": "string",
            "description": "Code régime"
          },
          "codeCaisse": {
            "type": "string",
            "description": "Code caisse"
          },
          "codeCentre": {
            "type": "string",
            "description": "Code centre"
          }
        }
      },
      "Dematerialisation": {
        "type": "object",
        "properties": {
          "isDematerialise": {
            "type": "boolean"
          },
          "email": {
            "type": "string",
            "description": "Email, obligatoire si 'isDematerialise' est défini à 'true'"
          },
          "mobile": {
            "type": "string",
            "description": "Numéro de téléphone"
          }
        },
        "required": [
          "isDematerialise"
        ]
      },
      "DestinatairePaiements": {
        "type": "object",
        "properties": {
          "idDestinatairePaiements": {
            "type": "string",
            "description": "Identifiant unique du destinataire de prestation pour le backoffice émetteur"
          },
          "idBeyondDestinatairePaiements": {
            "type": "string",
            "description": "Identifiant unique du destinataire de prestation au sein de Beyond. Ne pas renseigner"
          },
          "nom": {
            "$ref": "#/components/schemas/NomDestinataire",
            "description": "Nom du destinataire de prestation"
          },
          "adresse": {
            "$ref": "#/components/schemas/Adresse",
            "description": "Adresse du destinataire de prestation"
          },
          "rib": {
            "$ref": "#/components/schemas/RibAssure",
            "description": "RIB du destinataire du paiement. Obligatoire si modePaiementPrestations.code = virement. Contrôle de l’IBAN zone SEPA "
          },
          "modePaiementPrestations": {
            "$ref": "#/components/schemas/ModePaiement",
            "description": "Mode de paiement des prestations"
          },
          "periode": {
            "$ref": "#/components/schemas/Periode",
            "description": "Période sur laquelle le destinataire de prestation est valide"
          }
        },
        "required": [
          "idDestinatairePaiements",
          "nom",
          "periode"
        ]
      },
      "DestinataireRelevesPrestations": {
        "type": "object",
        "properties": {
          "idDestinataireRelevesPrestations": {
            "type": "string",
            "description": "Identifiant unique du destinataire de relevé de prestation pour le backoffice émetteur"
          },
          "idBeyondDestinataireRelevesPrestations": {
            "type": "string",
            "description": "Identifiant unique du destinataire de relevé de prestation au sein de Beyond. Ne pas renseigner"
          },
          "dematerialisation": {
            "$ref": "#/components/schemas/Dematerialisation",
            "description": "Informations de dématérialisation"
          },
          "nom": {
            "$ref": "#/components/schemas/NomDestinataire",
            "description": "Nom du destinataire de relevé de prestation"
          },
          "adresse": {
            "$ref": "#/components/schemas/AdresseAssure",
            "description": "Adresse du destinataire de relevé de prestation"
          },
          "periode": {
            "$ref": "#/components/schemas/Periode",
            "description": "Période sur laquelle le destinataire de relevé de prestation est valide"
          }
        },
        "required": [
          "idDestinataireRelevesPrestations",
          "dematerialisation",
          "nom",
          "periode"
        ]
      },
      "ModePaiement": {
        "required": [
          "code",
          "codeMonnaie",
          "libelle"
        ],
        "type": "object",
        "properties": {
          "code": {
            "type": "string",
            "description": "Code du mode paiement",
            "enum": [
              "VIR",
              "CHQ",
              "ESP"
            ]
          },
          "libelle": {
            "type": "string",
            "description": "Libellé du mode de paiement",
            "enum": [
              "Virement",
              "Chèque",
              "Espèces"
            ]
          },
          "codeMonnaie": {
            "type": "string",
            "description": "Code de la monnaie. Exemple : EUR"
          }
        }
      },
      "NomAssure": {
        "required": [
          "civilite",
          "nomFamille",
          "prenom"
        ],
        "type": "object",
        "properties": {
          "nomFamille": {
            "type": "string",
            "description": "Nom de famille de l'assuré"
          },
          "nomUsage": {
            "type": "string",
            "description": "Nom d'usage de l'assuré"
          },
          "prenom": {
            "type": "string",
            "description": "Prénom de l'assuré"
          },
          "civilite": {
            "type": "string",
            "description": "Civilité de l'assuré"
          }
        }
      },
      "NomDestinataire": {
        "type": "object",
        "properties": {
          "nomFamille": {
            "type": "string",
            "description": "Nom de famille du destinataire"
          },
          "nomUsage": {
            "type": "string",
            "description": "Nom d'usage du destinataire"
          },
          "prenom": {
            "type": "string",
            "description": "Prénom du destinataire"
          },
          "civilite": {
            "type": "string",
            "description": "Civilité du destinataire"
          },
          "raisonSociale": {
            "type": "string",
            "description": "Raison sociale du destinataire"
          }
        },
        "required": [
          "civilite"
        ]
      },
      "Periode": {
        "required": [
          "debut"
        ],
        "type": "object",
        "properties": {
          "debut": {
            "type": "string",
            "description": "Date de début"
          },
          "fin": {
            "type": "string",
            "description": "Date de fin"
          }
        }
      },
      "RibAssure": {
        "required": [
          "bic",
          "iban"
        ],
        "type": "object",
        "properties": {
          "bic": {
            "type": "string",
            "description": "BIC lié à l'IBAN utilisé pour les remboursements"
          },
          "iban": {
            "type": "string",
            "description": "IBAN utilisé pour les remboursements. Contrôle format IBAN zone SEPA"
          }
        }
      },
      "Reponse": {
        "type": "object",
        "properties": {
          "traceid": {
            "type": "string",
            "description": "Identifiant technique de la trace du contrat"
          },
          "status": {
            "type": "string",
            "description": "Statut du traitement du contrat."
          },
          "errorMessages": {
            "type": "array",
            "items": {
              "type": "string",
              "description": "Messages d'erreur."
            }
          },
          "provider": {
            "type": "string",
            "description": "Origine de l'erreur. Valorisé à BDDS pour toutes les erreurs fonctionnelles"
          }
        }
      },
      "Contrat": {
        "type": "object",
        "properties": {
          "idDeclarant": {
            "type": "string",
            "description": "Organisation principale"
          },
          "societeEmettrice": {
            "type": "string",
            "description": "Organisation secondaire"
          },
          "numero": {
            "type": "string",
            "description": "Identifiant du contrat dans le backoffice contrat"
          },
          "numeroExterne": {
            "type": "string",
            "description": "Identifiant du contrat en cas de reprise d'un autre SI"
          },
          "numeroAdherent": {
            "type": "string",
            "description": "Identifiant du souscripteur du contrat"
          },
          "numeroAdherentComplet": {
            "type": "string",
            "description": "Identifiant du souscripteur du contrat dans le backoffice externe"
          },
          "dateSouscription": {
            "type": "string",
            "description": "Date de souscription du contrat"
          },
          "dateResiliation": {
            "type": "string",
            "description": "Date de résiliation du contrat"
          },
          "apporteurAffaire": {
            "type": "string",
            "description": "Raison sociale de l'apporteur d'affaire"
          },
          "periodesContratResponsableOuvert": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Periode"
            },
            "description": "Periodes durant lesquelles le contrat est considéré comme 'contrat responsable'"
          },
          "critereSecondaireDetaille": {
            "type": "string",
            "description": "Information permettant de découper la population (notion de portefeuille dans Organisation)"
          },
          "critereSecondaire": {
            "type": "string",
            "description": "Valeur inscrite au niveau de l’entête de l’attestation papier délivrée aux assurés issue du SI du backoffice"
          },
          "isContratIndividuel": {
            "type": "boolean",
            "description": "Booléen permettant de définir si le contrat est en gestion individuelle"
          },
          "gestionnaire": {
            "type": "string",
            "description": "Code du gestionnaire gérant le contrat. Valeur non contrôlée  (exemple : Adhérent, Gestionnaire, Entreprise)"
          },
          "contratCollectif": {
            "$ref": "#/components/schemas/ContratCollectif",
            "description": "Information du contrat collectif"
          },
          "qualification": {
            "type": "string",
            "description": "Valeur permettant de qualifier le contrat. Gestion des contrats de base uniquement",
            "enum": [
              "B"
            ]
          },
          "ordrePriorisation": {
            "type": "string",
            "description": "Ordre de priorisation du contrat. Utilisable en cas de multi contrats sinon valorisé à '1'"
          }
        }
      },
      "ContratCollectif": {
        "required": [
          "numero"
        ],
        "type": "object",
        "properties": {
          "numero": {
            "type": "string",
            "description": "Identifiant du contrat collectif dans le backoffice externe"
          },
          "numeroExterne": {
            "type": "string",
            "description": "Identificant complémentaire pour le contrat collectif"
          }
        }
      }
    }
  }
}